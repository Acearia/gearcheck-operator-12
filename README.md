
# Checklist-AFM - Guia Completo Para Iniciantes

## üìã O que vamos construir?

Um sistema completo de checklist para equipamentos AFM com:
- **Frontend**: Interface web em React (o que voc√™ v√™ no navegador)
- **Backend**: Servidor que processa os dados (Node.js + Express)
- **Banco de dados**: SQLite para armazenar as informa√ß√µes
- **Docker**: Containers para organizar tudo

## üõ†Ô∏è Pr√©-requisitos (O que voc√™ precisa instalar)

### 1. Instalar Docker Desktop

**No Windows:**
1. V√° para https://www.docker.com/products/docker-desktop/
2. Clique em "Download for Windows"
3. Execute o arquivo baixado (.exe)
4. Siga o instalador (clique "Next", "Next", "Install")
5. Reinicie o computador quando pedido
6. Abra o Docker Desktop (√≠cone da baleia azul)

**No Mac:**
1. V√° para https://www.docker.com/products/docker-desktop/
2. Clique em "Download for Mac"
3. Arraste o Docker.app para a pasta Applications
4. Abra o Docker Desktop

**No Linux (Ubuntu/Debian):**
```bash
# Atualizar sistema
sudo apt update

# Instalar Docker
sudo apt install docker.io docker-compose

# Adicionar seu usu√°rio ao grupo docker
sudo usermod -aG docker $USER

# Reiniciar para aplicar mudan√ßas
sudo reboot
```

### 2. Verificar se Docker est√° funcionando

Abra o **Terminal** (Windows: CMD ou PowerShell, Mac/Linux: Terminal) e digite:

```bash
docker --version
```

Voc√™ deve ver algo como: `Docker version 20.10.x`

```bash
docker-compose --version
```

Voc√™ deve ver: `docker-compose version 1.29.x`

## üìÅ Estrutura do Projeto

Primeiro, vamos organizar os arquivos. No seu computador, crie esta estrutura:

```
checklist-afm/
‚îú‚îÄ‚îÄ frontend/          # Seu c√≥digo React atual
‚îú‚îÄ‚îÄ backend/           # Servidor Node.js (vamos criar)
‚îú‚îÄ‚îÄ database/          # Scripts do banco SQLite
‚îú‚îÄ‚îÄ docker/            # Configura√ß√µes Docker
‚îú‚îÄ‚îÄ deploy/            # Scripts para publicar
‚îî‚îÄ‚îÄ docker-compose.yml # Arquivo principal
```

## üöÄ Passo 1: Preparar o Ambiente

### 1.1 Criar as pastas

No terminal, navegue at√© onde voc√™ quer criar o projeto:

```bash
# Exemplo: ir para √°rea de trabalho
cd Desktop

# Criar pasta principal
mkdir checklist-afm
cd checklist-afm

# Criar subpastas
mkdir backend database docker deploy
```

### 1.2 Mover seu c√≥digo atual

Copie todos os arquivos do seu projeto React atual para a pasta `frontend/`:

```bash
# Se voc√™ est√° na pasta do projeto atual
cp -r . ../checklist-afm/frontend/

# Ou mova manualmente pelo explorador de arquivos
```

## üóÑÔ∏è Passo 2: Criar o Backend (Servidor)

### 2.1 Configurar o servidor Node.js

Entre na pasta backend:

```bash
cd backend
```

Crie o arquivo `package.json`:

```bash
cat > package.json << 'EOF'
{
  "name": "checklist-afm-backend",
  "version": "1.0.0",
  "description": "Backend API para Checklist AFM",
  "main": "server.js",
  "scripts": {
    "start": "node server.js",
    "dev": "nodemon server.js",
    "init-db": "node scripts/init-database.js"
  },
  "dependencies": {
    "express": "^4.18.2",
    "cors": "^2.8.5",
    "sqlite3": "^5.1.6",
    "bcryptjs": "^2.4.3",
    "jsonwebtoken": "^9.0.2",
    "multer": "^1.4.5-lts.1",
    "dotenv": "^16.3.1"
  },
  "devDependencies": {
    "nodemon": "^3.0.1"
  }
}
EOF
```

### 2.2 Criar o servidor principal

Crie o arquivo `server.js`:

```bash
cat > server.js << 'EOF'
const express = require('express');
const cors = require('cors');
const path = require('path');
require('dotenv').config();

const app = express();
const PORT = process.env.PORT || 3001;

// Middleware - permite comunica√ß√£o entre frontend e backend
app.use(cors());
app.use(express.json({ limit: '50mb' }));
app.use(express.urlencoded({ extended: true, limit: '50mb' }));

// Servir arquivos de upload (fotos, documentos)
app.use('/uploads', express.static(path.join(__dirname, 'uploads')));

// Rotas da API - cada rota cuida de uma funcionalidade
app.use('/api/auth', require('./routes/auth'));           // Login/logout
app.use('/api/operators', require('./routes/operators')); // Operadores
app.use('/api/equipment', require('./routes/equipment')); // Equipamentos
app.use('/api/inspections', require('./routes/inspections')); // Inspe√ß√µes
app.use('/api/leaders', require('./routes/leaders'));     // L√≠deres
app.use('/api/sectors', require('./routes/sectors'));     // Setores

// Rota para verificar se servidor est√° funcionando
app.get('/health', (req, res) => {
  res.json({ 
    status: 'OK', 
    message: 'Servidor Checklist AFM funcionando!',
    timestamp: new Date().toISOString() 
  });
});

// Iniciar servidor
app.listen(PORT, '0.0.0.0', () => {
  console.log(`üöÄ Servidor Checklist AFM rodando na porta ${PORT}`);
  console.log(`üåê Acesse: http://localhost:${PORT}/health`);
});
EOF
```

## üóÉÔ∏è Passo 3: Configurar o Banco de Dados SQLite

### 3.1 Criar estrutura do banco

```bash
# Criar pastas
mkdir -p database scripts

# Criar schema (estrutura das tabelas)
cat > database/schema.sql << 'EOF'
-- Tabela de operadores (pessoas que fazem checklist)
CREATE TABLE IF NOT EXISTS operators (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    name VARCHAR(100) NOT NULL,
    position VARCHAR(100),
    sector VARCHAR(50),
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP
);

-- Tabela de equipamentos (m√°quinas para inspecionar)
CREATE TABLE IF NOT EXISTS equipment (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    name VARCHAR(100) NOT NULL,
    kp VARCHAR(20),
    sector VARCHAR(50),
    capacity VARCHAR(50),
    type VARCHAR(20),
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP
);

-- Tabela de l√≠deres (supervisores)
CREATE TABLE IF NOT EXISTS leaders (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    name VARCHAR(100) NOT NULL,
    email VARCHAR(100),
    sector VARCHAR(50),
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP
);

-- Tabela de setores (departamentos)
CREATE TABLE IF NOT EXISTS sectors (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    name VARCHAR(100) NOT NULL,
    description TEXT,
    leader_id INTEGER,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (leader_id) REFERENCES leaders(id)
);

-- Tabela de inspe√ß√µes (checklists preenchidos)
CREATE TABLE IF NOT EXISTS inspections (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    operator_id INTEGER NOT NULL,
    equipment_id INTEGER NOT NULL,
    inspection_date DATE NOT NULL,
    submission_date DATETIME DEFAULT CURRENT_TIMESTAMP,
    comments TEXT,
    signature TEXT,
    FOREIGN KEY (operator_id) REFERENCES operators(id),
    FOREIGN KEY (equipment_id) REFERENCES equipment(id)
);

-- Tabela de itens do checklist (cada pergunta/resposta)
CREATE TABLE IF NOT EXISTS checklist_items (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    inspection_id INTEGER NOT NULL,
    item_text TEXT NOT NULL,
    answer VARCHAR(10) NOT NULL, -- Sim, N√£o, N/A
    observation TEXT,
    FOREIGN KEY (inspection_id) REFERENCES inspections(id)
);

-- Tabela de fotos das inspe√ß√µes
CREATE TABLE IF NOT EXISTS inspection_photos (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    inspection_id INTEGER NOT NULL,
    photo_path VARCHAR(255) NOT NULL,
    uploaded_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (inspection_id) REFERENCES inspections(id)
);

-- Tabela de usu√°rios admin
CREATE TABLE IF NOT EXISTS admin_users (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    username VARCHAR(50) UNIQUE NOT NULL,
    password_hash VARCHAR(255) NOT NULL,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP
);
EOF
```

### 3.2 Script para criar o banco

```bash
cat > scripts/init-database.js << 'EOF'
const sqlite3 = require('sqlite3').verbose();
const fs = require('fs');
const path = require('path');
const bcrypt = require('bcryptjs');

console.log('üóÑÔ∏è Inicializando banco de dados SQLite...');

const dbPath = path.join(__dirname, '../database/checklist_afm.db');
const schemaPath = path.join(__dirname, '../database/schema.sql');

// Criar diret√≥rio se n√£o existir
const dbDir = path.dirname(dbPath);
if (!fs.existsSync(dbDir)) {
    fs.mkdirSync(dbDir, { recursive: true });
    console.log('üìÅ Diret√≥rio do banco criado');
}

const db = new sqlite3.Database(dbPath, (err) => {
    if (err) {
        console.error('‚ùå Erro ao conectar ao banco:', err);
        return;
    }
    console.log('‚úÖ Conectado ao banco SQLite');
});

// Ler e executar schema
const schema = fs.readFileSync(schemaPath, 'utf8');

db.serialize(() => {
    console.log('üìã Criando tabelas...');
    
    // Executar schema
    db.exec(schema, (err) => {
        if (err) {
            console.error('‚ùå Erro ao criar schema:', err);
            return;
        }
        console.log('‚úÖ Tabelas criadas com sucesso!');
    });

    // Inserir usu√°rio admin padr√£o
    console.log('üë§ Criando usu√°rio admin...');
    const adminPassword = bcrypt.hashSync('admin123', 10);
    db.run(
        'INSERT OR IGNORE INTO admin_users (username, password_hash) VALUES (?, ?)',
        ['admin', adminPassword],
        function(err) {
            if (err) {
                console.error('‚ùå Erro ao criar usu√°rio admin:', err);
            } else {
                console.log('‚úÖ Usu√°rio admin criado! (admin/admin123)');
            }
        }
    );

    // Inserir dados de exemplo
    console.log('üìä Inserindo dados de exemplo...');
    
    const sampleOperators = [
        ['Jo√£o Silva', 'Operador Senior', 'Produ√ß√£o'],
        ['Maria Santos', 'Operadora', 'Manuten√ß√£o'],
        ['Carlos Oliveira', 'Supervisor', 'Armaz√©m']
    ];

    const insertOperator = db.prepare('INSERT OR IGNORE INTO operators (name, position, sector) VALUES (?, ?, ?)');
    sampleOperators.forEach(operator => {
        insertOperator.run(operator);
    });
    insertOperator.finalize();

    const sampleEquipment = [
        ['Empilhadeira Toyota', 'EMP-001', 'Armaz√©m', '2.5T', 'Empilhadeira'],
        ['Guindaste Liebherr', 'GUI-001', 'Produ√ß√£o', '50T', 'Guindaste'],
        ['Compressor Atlas', 'COMP-001', 'Manuten√ß√£o', '10HP', 'Compressor']
    ];

    const insertEquipment = db.prepare('INSERT OR IGNORE INTO equipment (name, kp, sector, capacity, type) VALUES (?, ?, ?, ?, ?)');
    sampleEquipment.forEach(equipment => {
        insertEquipment.run(equipment);
    });
    insertEquipment.finalize();

    console.log('‚úÖ Dados de exemplo inseridos!');
});

db.close((err) => {
    if (err) {
        console.error('‚ùå Erro ao fechar banco:', err);
    } else {
        console.log('üéâ Banco de dados inicializado com sucesso!');
        console.log('üìç Localiza√ß√£o:', dbPath);
    }
});
EOF
```

## üõ£Ô∏è Passo 4: Criar as Rotas da API

### 4.1 Criar pasta de rotas

```bash
mkdir routes
cd routes
```

### 4.2 Rota de autentica√ß√£o (Login)

```bash
cat > auth.js << 'EOF'
const express = require('express');
const bcrypt = require('bcryptjs');
const jwt = require('jsonwebtoken');
const sqlite3 = require('sqlite3').verbose();
const path = require('path');

const router = express.Router();
const dbPath = path.join(__dirname, '../database/checklist_afm.db');

// Rota de login
router.post('/login', (req, res) => {
    const { username, password } = req.body;
    console.log(`üîê Tentativa de login: ${username}`);
    
    const db = new sqlite3.Database(dbPath);

    db.get(
        'SELECT * FROM admin_users WHERE username = ?',
        [username],
        (err, user) => {
            if (err) {
                console.error('‚ùå Erro no banco:', err);
                return res.status(500).json({ error: 'Erro interno do servidor' });
            }

            if (!user || !bcrypt.compareSync(password, user.password_hash)) {
                console.log('‚ùå Login falhou: credenciais inv√°lidas');
                return res.status(401).json({ error: 'Credenciais inv√°lidas' });
            }

            const token = jwt.sign(
                { userId: user.id, username: user.username },
                process.env.JWT_SECRET || 'checklist-afm-secret',
                { expiresIn: '24h' }
            );

            console.log('‚úÖ Login realizado com sucesso');
            res.json({ 
                token, 
                user: { id: user.id, username: user.username } 
            });
        }
    );

    db.close();
});

module.exports = router;
EOF
```

### 4.3 Rota de operadores

```bash
cat > operators.js << 'EOF'
const express = require('express');
const sqlite3 = require('sqlite3').verbose();
const path = require('path');

const router = express.Router();
const dbPath = path.join(__dirname, '../database/checklist_afm.db');

// Listar todos os operadores
router.get('/', (req, res) => {
    console.log('üìã Buscando operadores...');
    const db = new sqlite3.Database(dbPath);
    
    db.all('SELECT * FROM operators ORDER BY name', (err, rows) => {
        if (err) {
            console.error('‚ùå Erro ao buscar operadores:', err);
            return res.status(500).json({ error: err.message });
        }
        console.log(`‚úÖ Encontrados ${rows.length} operadores`);
        res.json(rows);
    });
    
    db.close();
});

// Criar novo operador
router.post('/', (req, res) => {
    const { name, position, sector } = req.body;
    console.log(`‚ûï Criando operador: ${name}`);
    
    const db = new sqlite3.Database(dbPath);

    db.run(
        'INSERT INTO operators (name, position, sector) VALUES (?, ?, ?)',
        [name, position, sector],
        function(err) {
            if (err) {
                console.error('‚ùå Erro ao criar operador:', err);
                return res.status(500).json({ error: err.message });
            }
            console.log('‚úÖ Operador criado com sucesso');
            res.json({ id: this.lastID, name, position, sector });
        }
    );

    db.close();
});

// Atualizar operador
router.put('/:id', (req, res) => {
    const { id } = req.params;
    const { name, position, sector } = req.body;
    console.log(`‚úèÔ∏è Atualizando operador ID: ${id}`);
    
    const db = new sqlite3.Database(dbPath);

    db.run(
        'UPDATE operators SET name = ?, position = ?, sector = ? WHERE id = ?',
        [name, position, sector, id],
        function(err) {
            if (err) {
                console.error('‚ùå Erro ao atualizar operador:', err);
                return res.status(500).json({ error: err.message });
            }
            console.log('‚úÖ Operador atualizado com sucesso');
            res.json({ id, name, position, sector });
        }
    );

    db.close();
});

// Deletar operador
router.delete('/:id', (req, res) => {
    const { id } = req.params;
    console.log(`üóëÔ∏è Deletando operador ID: ${id}`);
    
    const db = new sqlite3.Database(dbPath);

    db.run('DELETE FROM operators WHERE id = ?', [id], function(err) {
        if (err) {
            console.error('‚ùå Erro ao deletar operador:', err);
            return res.status(500).json({ error: err.message });
        }
        console.log('‚úÖ Operador deletado com sucesso');
        res.json({ message: 'Operador deletado com sucesso' });
    });

    db.close();
});

module.exports = router;
EOF
```

### 4.4 Rota de equipamentos

```bash
cat > equipment.js << 'EOF'
const express = require('express');
const sqlite3 = require('sqlite3').verbose();
const path = require('path');

const router = express.Router();
const dbPath = path.join(__dirname, '../database/checklist_afm.db');

// Listar equipamentos
router.get('/', (req, res) => {
    console.log('üîß Buscando equipamentos...');
    const db = new sqlite3.Database(dbPath);
    
    db.all('SELECT * FROM equipment ORDER BY name', (err, rows) => {
        if (err) {
            console.error('‚ùå Erro ao buscar equipamentos:', err);
            return res.status(500).json({ error: err.message });
        }
        console.log(`‚úÖ Encontrados ${rows.length} equipamentos`);
        res.json(rows);
    });
    
    db.close();
});

// Criar equipamento
router.post('/', (req, res) => {
    const { name, kp, sector, capacity, type } = req.body;
    console.log(`‚ûï Criando equipamento: ${name}`);
    
    const db = new sqlite3.Database(dbPath);

    db.run(
        'INSERT INTO equipment (name, kp, sector, capacity, type) VALUES (?, ?, ?, ?, ?)',
        [name, kp, sector, capacity, type],
        function(err) {
            if (err) {
                console.error('‚ùå Erro ao criar equipamento:', err);
                return res.status(500).json({ error: err.message });
            }
            console.log('‚úÖ Equipamento criado com sucesso');
            res.json({ id: this.lastID, name, kp, sector, capacity, type });
        }
    );

    db.close();
});

// Outras rotas similares (PUT, DELETE)...
module.exports = router;
EOF
```

### 4.5 Outras rotas (criar arquivos similares)

```bash
# Rota de inspe√ß√µes
cat > inspections.js << 'EOF'
const express = require('express');
const sqlite3 = require('sqlite3').verbose();
const path = require('path');

const router = express.Router();
const dbPath = path.join(__dirname, '../database/checklist_afm.db');

// Listar inspe√ß√µes
router.get('/', (req, res) => {
    console.log('üìä Buscando inspe√ß√µes...');
    const db = new sqlite3.Database(dbPath);
    
    const query = `
        SELECT 
            i.*,
            o.name as operator_name,
            e.name as equipment_name,
            e.kp as equipment_kp
        FROM inspections i
        LEFT JOIN operators o ON i.operator_id = o.id
        LEFT JOIN equipment e ON i.equipment_id = e.id
        ORDER BY i.submission_date DESC
    `;
    
    db.all(query, (err, rows) => {
        if (err) {
            console.error('‚ùå Erro ao buscar inspe√ß√µes:', err);
            return res.status(500).json({ error: err.message });
        }
        console.log(`‚úÖ Encontradas ${rows.length} inspe√ß√µes`);
        res.json(rows);
    });
    
    db.close();
});

// Criar inspe√ß√£o
router.post('/', (req, res) => {
    const { operator_id, equipment_id, inspection_date, comments, signature, checklist_items } = req.body;
    console.log(`‚ûï Criando inspe√ß√£o para equipamento ID: ${equipment_id}`);
    
    const db = new sqlite3.Database(dbPath);

    db.serialize(() => {
        db.run('BEGIN TRANSACTION');
        
        // Inserir inspe√ß√£o
        db.run(
            'INSERT INTO inspections (operator_id, equipment_id, inspection_date, comments, signature) VALUES (?, ?, ?, ?, ?)',
            [operator_id, equipment_id, inspection_date, comments, signature],
            function(err) {
                if (err) {
                    console.error('‚ùå Erro ao criar inspe√ß√£o:', err);
                    db.run('ROLLBACK');
                    return res.status(500).json({ error: err.message });
                }
                
                const inspectionId = this.lastID;
                console.log(`‚úÖ Inspe√ß√£o criada com ID: ${inspectionId}`);
                
                // Inserir itens do checklist
                if (checklist_items && checklist_items.length > 0) {
                    const stmt = db.prepare('INSERT INTO checklist_items (inspection_id, item_text, answer, observation) VALUES (?, ?, ?, ?)');
                    
                    checklist_items.forEach(item => {
                        stmt.run([inspectionId, item.text, item.answer, item.observation || '']);
                    });
                    
                    stmt.finalize();
                    console.log(`‚úÖ ${checklist_items.length} itens do checklist inseridos`);
                }
                
                db.run('COMMIT');
                res.json({ id: inspectionId, message: 'Inspe√ß√£o criada com sucesso' });
            }
        );
    });

    db.close();
});

module.exports = router;
EOF

# Rotas simples para leaders e sectors
cat > leaders.js << 'EOF'
const express = require('express');
const sqlite3 = require('sqlite3').verbose();
const path = require('path');

const router = express.Router();
const dbPath = path.join(__dirname, '../database/checklist_afm.db');

router.get('/', (req, res) => {
    const db = new sqlite3.Database(dbPath);
    db.all('SELECT * FROM leaders ORDER BY name', (err, rows) => {
        if (err) return res.status(500).json({ error: err.message });
        res.json(rows);
    });
    db.close();
});

router.post('/', (req, res) => {
    const { name, email, sector } = req.body;
    const db = new sqlite3.Database(dbPath);
    db.run('INSERT INTO leaders (name, email, sector) VALUES (?, ?, ?)', [name, email, sector], function(err) {
        if (err) return res.status(500).json({ error: err.message });
        res.json({ id: this.lastID, name, email, sector });
    });
    db.close();
});

module.exports = router;
EOF

cat > sectors.js << 'EOF'
const express = require('express');
const sqlite3 = require('sqlite3').verbose();
const path = require('path');

const router = express.Router();
const dbPath = path.join(__dirname, '../database/checklist_afm.db');

router.get('/', (req, res) => {
    const db = new sqlite3.Database(dbPath);
    db.all('SELECT * FROM sectors ORDER BY name', (err, rows) => {
        if (err) return res.status(500).json({ error: err.message });
        res.json(rows);
    });
    db.close();
});

router.post('/', (req, res) => {
    const { name, description, leader_id } = req.body;
    const db = new sqlite3.Database(dbPath);
    db.run('INSERT INTO sectors (name, description, leader_id) VALUES (?, ?, ?)', [name, description, leader_id], function(err) {
        if (err) return res.status(500).json({ error: err.message });
        res.json({ id: this.lastID, name, description, leader_id });
    });
    db.close();
});

module.exports = router;
EOF
```

## üê≥ Passo 5: Configurar Docker

### 5.1 Voltar para pasta principal

```bash
cd ..  # Sair da pasta routes
cd ..  # Sair da pasta backend
```

### 5.2 Dockerfile para o Backend

```bash
cat > Dockerfile.backend << 'EOF'
# Usar Node.js vers√£o 18 (est√°vel)
FROM node:18-alpine

# Definir diret√≥rio de trabalho
WORKDIR /app

# Copiar arquivos de depend√™ncias primeiro (otimiza√ß√£o de cache)
COPY backend/package*.json ./

# Instalar depend√™ncias
RUN npm install

# Copiar todo o c√≥digo do backend
COPY backend/ .

# Criar diret√≥rios necess√°rios
RUN mkdir -p uploads database

# Porta que o servidor vai usar
EXPOSE 3001

# Comando para iniciar o servidor
CMD ["npm", "start"]
EOF
```

### 5.3 Dockerfile para o Frontend

```bash
cat > Dockerfile.frontend << 'EOF'
# Est√°gio 1: Build da aplica√ß√£o React
FROM node:18-alpine as builder

WORKDIR /app

# Copiar package.json do frontend
COPY frontend/package*.json ./

# Instalar depend√™ncias
RUN npm install

# Copiar c√≥digo fonte do frontend
COPY frontend/ .

# Fazer build da aplica√ß√£o
RUN npm run build

# Est√°gio 2: Servir com Nginx
FROM nginx:alpine

# Copiar arquivos buildados para o nginx
COPY --from=builder /app/dist /usr/share/nginx/html

# Copiar configura√ß√£o customizada do nginx
COPY docker/nginx.conf /etc/nginx/conf.d/default.conf

# Porta do nginx
EXPOSE 80

# Iniciar nginx
CMD ["nginx", "-g", "daemon off;"]
EOF
```

### 5.4 Configura√ß√£o do Nginx

```bash
mkdir -p docker
cat > docker/nginx.conf << 'EOF'
server {
    listen 80;
    server_name localhost;
    
    # Pasta onde est√£o os arquivos do React
    root /usr/share/nginx/html;
    index index.html;
    
    # Configura√ß√£o para Single Page Application (React Router)
    location / {
        try_files $uri $uri/ /index.html;
    }
    
    # Redirecionar chamadas da API para o backend
    location /api/ {
        proxy_pass http://backend:3001;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_cache_bypass $http_upgrade;
    }
    
    # Cache para arquivos est√°ticos (imagens, CSS, JS)
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
    }
}
EOF
```

### 5.5 Docker Compose (arquivo principal)

```bash
cat > docker-compose.yml << 'EOF'
version: '3.8'

services:
  # Frontend (React + Nginx)
  frontend:
    build:
      context: .
      dockerfile: Dockerfile.frontend
    ports:
      - "8080:80"  # Acesse pelo navegador em http://localhost:8080
    depends_on:
      - backend
    networks:
      - checklist-network

  # Backend (Node.js + Express)
  backend:
    build:
      context: .
      dockerfile: Dockerfile.backend
    ports:
      - "3001:3001"  # API dispon√≠vel em http://localhost:3001
    environment:
      - NODE_ENV=production
      - PORT=3001
      - JWT_SECRET=checklist-afm-super-secret-key-change-in-production
    volumes:
      - sqlite_data:/app/database      # Dados do SQLite persistem
      - uploads_data:/app/uploads      # Uploads persistem
    networks:
      - checklist-network
    # Inicializar banco antes de iniciar servidor
    command: sh -c "npm run init-db && npm start"

# Volumes para persistir dados
volumes:
  sqlite_data:      # Banco SQLite
  uploads_data:     # Arquivos enviados

# Rede para comunica√ß√£o entre containers
networks:
  checklist-network:
    driver: bridge
EOF
```

## üöÄ Passo 6: Scripts de Deploy

### 6.1 Script de build

```bash
mkdir -p deploy

cat > deploy/build.sh << 'EOF'
#!/bin/bash

echo "üöÄ === BUILD DO CHECKLIST AFM ==="
echo ""

# Parar containers existentes
echo "üì¶ Parando containers existentes..."
docker-compose down

# Remover imagens antigas para build limpo
echo "üßπ Limpando imagens antigas..."
docker system prune -f

# Build dos containers
echo "üî® Fazendo build dos containers..."
echo "   ‚è≥ Isso pode demorar alguns minutos na primeira vez..."
docker-compose build --no-cache

if [ $? -eq 0 ]; then
    echo ""
    echo "‚úÖ Build conclu√≠do com sucesso!"
    echo "üìã Pr√≥ximo passo: execute ./deploy/deploy.sh"
else
    echo ""
    echo "‚ùå Erro no build! Verifique as mensagens acima."
    exit 1
fi
EOF

chmod +x deploy/build.sh
```

### 6.2 Script de deploy

```bash
cat > deploy/deploy.sh << 'EOF'
#!/bin/bash

echo "üöÄ === DEPLOY DO CHECKLIST AFM ==="
echo ""

# Fazer build primeiro
echo "üî® Executando build..."
./deploy/build.sh

if [ $? -ne 0 ]; then
    echo "‚ùå Build falhou! Corrigindo..."
    exit 1
fi

# Iniciar containers
echo ""
echo "‚ñ∂Ô∏è Iniciando containers..."
docker-compose up -d

# Aguardar containers iniciarem
echo "‚è≥ Aguardando containers iniciarem..."
sleep 10

# Verificar status
echo ""
echo "üîç Verificando status dos containers..."
docker-compose ps

# Testar sa√∫de dos servi√ßos
echo ""
echo "üè• Testando sa√∫de dos servi√ßos..."

# Testar backend
echo "   üîç Testando backend..."
if curl -f http://localhost:3001/health > /dev/null 2>&1; then
    echo "   ‚úÖ Backend OK"
else
    echo "   ‚ùå Backend n√£o est√° respondendo"
fi

# Testar frontend
echo "   üîç Testando frontend..."
if curl -f http://localhost:8080 > /dev/null 2>&1; then
    echo "   ‚úÖ Frontend OK"
else
    echo "   ‚ùå Frontend n√£o est√° respondendo"
fi

echo ""
echo "üéâ === DEPLOY CONCLU√çDO ==="
echo ""
echo "üìç URLs de Acesso:"
echo "   üåê Frontend: http://localhost:8080"
echo "   üîó Backend API: http://localhost:3001"
echo "   üè• Health Check: http://localhost:3001/health"
echo ""
echo "üë§ Login Admin:"
echo "   üìß Usu√°rio: admin"
echo "   üîë Senha: admin123"
echo ""
echo "üìä Para ver logs: docker-compose logs -f"
echo "üõë Para parar: docker-compose down"
EOF

chmod +x deploy/deploy.sh
```

### 6.3 Script de backup

```bash
cat > deploy/backup.sh << 'EOF'
#!/bin/bash

BACKUP_DIR="./backups"
TIMESTAMP=$(date +%Y%m%d_%H%M%S)

echo "üíæ === BACKUP DO CHECKLIST AFM ==="
echo ""

# Criar diret√≥rio de backup
mkdir -p $BACKUP_DIR

echo "üìÇ Fazendo backup do banco de dados..."
# Backup do banco SQLite
docker-compose exec -T backend cp /app/database/checklist_afm.db /app/database/backup_${TIMESTAMP}.db
docker cp $(docker-compose ps -q backend):/app/database/backup_${TIMESTAMP}.db $BACKUP_DIR/

echo "üìÅ Fazendo backup dos uploads..."
# Backup dos arquivos enviados
docker run --rm -v checklist-afm_uploads_data:/uploads -v $(pwd)/$BACKUP_DIR:/backup alpine tar czf /backup/uploads_${TIMESTAMP}.tar.gz -C /uploads .

echo ""
echo "‚úÖ Backup conclu√≠do!"
echo "üìç Arquivos salvos em: $BACKUP_DIR"
echo ""
ls -la $BACKUP_DIR
EOF

chmod +x deploy/backup.sh
```

## ‚ñ∂Ô∏è Passo 7: EXECUTAR TUDO!

### 7.1 Primeiro deploy

```bash
# No terminal, dentro da pasta checklist-afm
./deploy/deploy.sh
```

**O que voc√™ deve ver:**
- Muitas linhas de download e build (primeira vez demora)
- "Build conclu√≠do com sucesso!"
- "Containers iniciando..."
- "Deploy conclu√≠do!"

### 7.2 Testar se est√° funcionando

Abra seu navegador e acesse:

1. **Frontend**: http://localhost:8080
   - Voc√™ deve ver a p√°gina inicial do Checklist AFM

2. **Backend**: http://localhost:3001/health
   - Voc√™ deve ver: `{"status":"OK","message":"Servidor Checklist AFM funcionando!"}`

3. **Login Admin**: http://localhost:8080/admin/login
   - Usu√°rio: `admin`
   - Senha: `admin123`

## üîß Comandos √öteis

### Ver o que est√° acontecendo
```bash
# Ver logs dos containers
docker-compose logs -f

# Ver apenas logs do backend
docker-compose logs -f backend

# Ver apenas logs do frontend
docker-compose logs -f frontend
```

### Parar e iniciar
```bash
# Parar tudo
docker-compose down

# Iniciar novamente
docker-compose up -d

# Reiniciar apenas um servi√ßo
docker-compose restart backend
```

### Entrar nos containers
```bash
# Entrar no container do backend
docker-compose exec backend sh

# Ver banco SQLite diretamente
docker-compose exec backend sqlite3 /app/database/checklist_afm.db
```

### Backup manual
```bash
# Executar backup
./deploy/backup.sh
```

## üÜò Resolu√ß√£o de Problemas

### Problema: "docker: command not found"
**Solu√ß√£o:** Docker n√£o est√° instalado. Volte ao Passo 1.

### Problema: "Permission denied"
**Solu√ß√£o:** 
```bash
chmod +x deploy/*.sh
```

### Problema: "Port already in use"
**Solu√ß√£o:** Algum programa est√° usando a porta 8080 ou 3001
```bash
# Ver o que est√° usando a porta
lsof -i :8080
lsof -i :3001

# Matar processo
kill -9 <PID>
```

### Problema: Containers n√£o iniciam
**Solu√ß√£o:**
```bash
# Ver logs de erro
docker-compose logs

# Rebuild completo
docker-compose down
docker system prune -a
./deploy/deploy.sh
```

### Problema: Frontend n√£o carrega
**Verificar:**
1. http://localhost:8080 est√° acess√≠vel?
2. Logs do nginx: `docker-compose logs frontend`

### Problema: API n√£o funciona
**Verificar:**
1. http://localhost:3001/health responde?
2. Logs do backend: `docker-compose logs backend`
3. Banco foi criado? `docker-compose exec backend ls -la database/`

## üì± Conectar Frontend ao Backend

### Criar cliente de API no frontend

No seu projeto React, criar arquivo `src/lib/api.ts`:

```typescript
const API_BASE_URL = process.env.NODE_ENV === 'production' 
  ? '/api'  // Em produ√ß√£o usa proxy do nginx
  : 'http://localhost:3001/api';  // Em desenvolvimento

class ApiClient {
  private baseURL: string;
  private token: string | null = null;

  constructor() {
    this.baseURL = API_BASE_URL;
    this.token = localStorage.getItem('checklist-afm-token');
  }

  private async request(endpoint: string, options: RequestInit = {}) {
    const url = `${this.baseURL}${endpoint}`;
    
    const config: RequestInit = {
      headers: {
        'Content-Type': 'application/json',
        ...(this.token && { Authorization: `Bearer ${this.token}` }),
        ...options.headers,
      },
      ...options,
    };

    const response = await fetch(url, config);
    
    if (!response.ok) {
      throw new Error(`HTTP error! status: ${response.status}`);
    }
    
    return await response.json();
  }

  // M√©todos para usar na aplica√ß√£o
  async login(username: string, password: string) {
    const response = await this.request('/auth/login', {
      method: 'POST',
      body: JSON.stringify({ username, password }),
    });
    
    if (response.token) {
      this.token = response.token;
      localStorage.setItem('checklist-afm-token', response.token);
    }
    
    return response;
  }

  async getOperators() {
    return this.request('/operators');
  }

  async getEquipment() {
    return this.request('/equipment');
  }

  async createInspection(inspection: any) {
    return this.request('/inspections', {
      method: 'POST',
      body: JSON.stringify(inspection),
    });
  }
}

export const apiClient = new ApiClient();
```

## üèóÔ∏è Estrutura Final

```
checklist-afm/
‚îú‚îÄ‚îÄ frontend/              # Seu c√≥digo React
‚îú‚îÄ‚îÄ backend/               # Servidor Node.js
‚îÇ   ‚îú‚îÄ‚îÄ routes/           # Rotas da API
‚îÇ   ‚îú‚îÄ‚îÄ scripts/          # Scripts do banco
‚îÇ   ‚îú‚îÄ‚îÄ database/         # Banco SQLite
‚îÇ   ‚îî‚îÄ‚îÄ server.js         # Servidor principal
‚îú‚îÄ‚îÄ docker/               # Configura√ß√µes Docker
‚îú‚îÄ‚îÄ deploy/               # Scripts de deploy
‚îú‚îÄ‚îÄ docker-compose.yml    # Arquivo principal
‚îî‚îÄ‚îÄ README.md            # Este guia
```

## üéØ Resumo dos Comandos

```bash
# Deploy completo (primeira vez)
./deploy/deploy.sh

# Ver status
docker-compose ps

# Ver logs
docker-compose logs -f

# Parar
docker-compose down

# Backup
./deploy/backup.sh

# Rebuild (se algo der errado)
docker-compose down
docker system prune -a
./deploy/deploy.sh
```

## üéâ Pronto!

Agora voc√™ tem:
- ‚úÖ Frontend React rodando em http://localhost:8080
- ‚úÖ Backend Node.js rodando em http://localhost:3001  
- ‚úÖ Banco SQLite funcionando
- ‚úÖ Docker organizando tudo
- ‚úÖ Sistema de backup
- ‚úÖ Login admin (admin/admin123)

**Pr√≥ximos passos:**
1. Teste o sistema acessando http://localhost:8080
2. Fa√ßa login como admin
3. Conecte seu frontend React ao backend usando o arquivo `api.ts`
4. Configure backup autom√°tico (cron job)

**Para produ√ß√£o:**
- Mude a senha do admin
- Configure SSL/HTTPS
- Use um dom√≠nio pr√≥prio
- Configure monitoramento

Qualquer d√∫vida, execute `docker-compose logs -f` para ver o que est√° acontecendo! üöÄ
